<form [formGroup]="applicationForm">
    <div class="card">
        <div class="card-header">
            <div class="d-flex flex-row justify-content-between">
                <h4 class="mb-2">Scholarship Program Application</h4>
                <div class="dropdown" ngbDropdown>
                    <a href="javascript:void(0);" class="arrow-none" role="button" id="dropdownMenuLink5" data-bs-toggle="dropdown" aria-expanded="false" ngbDropdownToggle>
                        <button type="button" class="btn btn-outline-primary btn-icon waves-effect waves-light"><i class="ri-more-2-fill"></i></button>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-up" aria-labelledby="dropdownMenuLink5" ngbDropdownMenu>
                        <li>
                            <a class="dropdown-item" ><i class="mx-1 ri-eye-line"></i>View Provisional Sponsorship Letter</a>
                        </li>
                        <li (click)="openModal(uploadAcceptanceLetter)">
                            <a class="dropdown-item" ><i class="mx-1 ri-download-cloud-2-line"></i>Upload Acceptance Letter</a>
                        </li>
                    </ul>
                </div>      
            </div>

        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 mb-2">
                    <label class="form-label"
                    >Applying Year<span class="text-danger">{{ " *" }}</span></label>
                    <ng-select
                    [items]="intakeYears"
                    formControlName="applyingYear"
                    placeholder="Select your Intake Year"
                    >
                    </ng-select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Full Name</label>
                  <input type="text" formControlName="fullName" class="form-control"/>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label"
                      >Please of Birth<span class="text-danger">{{ " *" }}</span>
                    </label>
                    <ng-select
                      [items]="listData.countryList"
                      placeholder="Place of Birth"
                      bindLabel="name"
                      formControlName="placeOfBirth"
                      bindValue="code"
                    >
                    </ng-select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Age<span class="text-danger">{{ " *" }}</span></label>
                    <ng-select [items]="listData.age" formControlName="age" placeholder="Please select">
                    </ng-select>
                  </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Gender<span class="text-danger">{{ " *" }}</span></label>
                  <ng-select [items]="listData.gender" formControlName="gender"
                    bindLabel="name" bindValue="value" placeholder="Please select">
                  </ng-select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Nationality<span class="text-danger">{{ " *" }}</span></label>
                  <ng-select [items]="listData.nationalities" formControlName="nationality"
                  bindLabel="name" bindValue="name" placeholder="Please select">
                  </ng-select>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label" >Birthday<span class="text-danger">{{ " *" }}</span></label>
                  <input class="form-control flatpickr-input" type="text"
                    formControlName="birthDate" mwlFlatpickr [altInput]="true" [convertModelValue]="true"/>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Email Address<span class="text-danger">{{ " *" }}</span></label>
                  <input type="text" formControlName="email" class="form-control"/>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Contact Number<span class="text-danger">{{ " *" }}</span></label>
                  <ngx-intl-tel-input [cssClass]="'custom'" 
                  [preferredCountries]="preferredCountries" [enableAutoCountrySelect]="true" [enablePlaceholder]="true" [searchCountryFlag]="true"
                  [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name]"
                  [selectFirstCountry]="false" [selectedCountryISO]="CountryISO.Oman"
                  [maxLength]="15" [phoneValidation]="true" [numberFormat]="PhoneNumberFormat.National" formControlName="contactNumber">
                </ngx-intl-tel-input>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label">Marital Status<span class="text-danger">{{ " *" }}</span></label>
                        <ng-select
                        [items]="listData.maritalStatus"
                        formControlName="maritalStatus"
                        placeholder="Select your Marital Status"
                        bindLabel="name"
                        bindValue="value"
                        >
                        </ng-select>
                    </div>
                    </div>
                    <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label"
                        >Address<span class="text-danger">{{
                            " *"
                        }}</span></label
                        >
                        <input type="text" formControlName="address" class="form-control" />
                    </div>
                    </div>
                    <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label"
                        >Governorate<span class="text-danger">{{
                            " *"
                        }}</span>
                        </label>
                        <ng-select
                        [items]="listData.governorateList"
                        formControlName="governorate"
                        placeholder="Select your Governorate"
                        bindLabel="name"
                        bindValue="value"
                        >
                        </ng-select>
                    </div>
                    </div>
                    <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label"
                        >Wilayat/Region<span
                            class="text-danger"
                            >{{ " *" }}</span
                        ></label
                        >
                        <ng-select
                        [items]="listData.wilayatList"
                        formControlName="wilayatOrRegion"
                        placeholder="Select your Wilayat/Region"
                        bindLabel="name"
                        bindValue="value"
                        >
                        </ng-select>
                    </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label"
                            >Name of Next of Kin (NOK)<span
                                class="text-danger"
                                >{{ " *" }}</span
                            ></label
                            >
                            <input type="text" formControlName="nextOfKin" class="form-control" />
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label"
                        >Contact No. of NOK<span
                            class="text-danger"
                            >{{ " *" }}</span
                        ></label
                        >
                        <ngx-intl-tel-input [cssClass]="'custom'" 
                        [preferredCountries]="preferredCountries" [enableAutoCountrySelect]="true" [enablePlaceholder]="true" [searchCountryFlag]="true"
                        [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name]"
                        [selectFirstCountry]="false" [selectedCountryISO]="CountryISO.Oman"
                        [maxLength]="15" [phoneValidation]="true" [numberFormat]="PhoneNumberFormat.National" formControlName="contactNextOfKin">
                        </ngx-intl-tel-input>
                  </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label"
                    >National Id Card No.<span
                        class="text-danger"
                        >{{ " *" }}</span
                    ></label
                    >
                    <input type="text" formControlName="nationIdNumber" class="form-control" />
                </div>
                <div class="col-md-3 mb-align-items-center justify-content-center">
                    <div class="h-100 d-flex flex-row align-items-center justify-content-center">
                        <p class="h6">Download National Id Card</p>
                        <button type="button" class="mx-3 btn btn-outline-primary btn-icon waves-effect waves-light"><i class=" ri-download-cloud-line"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label"
                        >Examination Type<span
                            class="text-danger"
                            >{{ " *" }}</span
                        ></label
                        >
                        <ng-select
                        [items]="listData.examType"
                        formControlName="examType"
                        placeholder="Select your Examination Type"
                        bindLabel="name"
                        bindValue="value"
                        >
                        </ng-select>
                </div>
                <div class="col-md-3 mb-3" *ngIf="formValues.examType === 'OMSB_Selection_Exam'">
                    <label class="form-label">OMSB Selection Exam Score</label>
                    <input type="text" formControlName="omsbSelectionExamScore" class="form-control"/>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 mb-3" *ngIf="formValues.examType === 'MFD'">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault" formControlName="isMfdPassed"/>
                        <label class="form-check-label" for="flexSwitchCheckDefault">Have you passed the MFD II?<span
                            class="text-danger">{{ " *" }}</span
                        ></label>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="d-flex flex-row align-items-center">
                        <p class="h6">Download MFD Part II</p>
                        <button type="button" class="mx-3 btn btn-outline-primary btn-icon waves-effect waves-light"><i class=" ri-download-cloud-line"></i></button>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="d-flex flex-row align-items-center">
                        <p class="h6">Trainee Certificates</p>
                        <button type="button" class="mx-3 btn btn-outline-primary btn-icon waves-effect waves-light"><i class=" ri-download-cloud-line"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 mb-3">
                  <div class="form-check form-switch">
                      <input
                      class="form-check-input"
                      type="checkbox"
                      role="switch"
                      id="flexSwitchCheckDefault" formControlName="haveDiseases"/>
                      <label
                      class="form-check-label"
                      for="flexSwitchCheckDefault"
                      >List any Disabilities or Diseases<span
                          class="text-danger"
                          >{{ " *" }}</span
                      ></label
                      >
                  </div>
                </div>
                <div class="col-md-4" *ngIf="formValues.haveDiseases">
                  <div class="mb-3">
                      <label class="form-label"
                      >Please provide the name of the disease
                      or disability<span
                          class="text-danger"
                          >{{ " *" }}</span
                      ></label
                      >
                      <textarea type="text" (resize)="(false)" rows="2" class="form-control" formControlName="diseasesOrDisabilities"></textarea>
                  </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="d-flex flex-row">
                <p class="h5">Education</p>
            </div>
            <div formArrayName="education">
                <div
                class="mt-2 d-flex flex-column border p-3"
                *ngFor="let schools of educationControls; let i = index"
                [formGroupName]="i"
                >
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">Name of University / College<span
                            class="text-danger" >{{ " *" }}</span></label>
                        <ng-select
                        [items]="listData.educationInstitutesList" formControlName="school"
                        placeholder="Name of University / College" bindLabel="name"
                        bindValue="value">
                        </ng-select>
                    </div>
                    <div class="col-md-3" *ngIf=" formValues.school === 'other'">
                        <label class="form-label"
                        >Specify the name of University / College<span class="text-danger">{{ " *" }}</span></label>
                        <input formControlName="otherName"
                        type="text"
                        class="form-control"
                        />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label"
                        >Degree Obtained<span
                            class="text-danger"
                            >{{ " *" }}</span
                        ></label
                        >
                        <ng-select
                        [items]="listData.degreeList"
                        formControlName="degreeObtained"
                        placeholder="Degree"
                        bindLabel="name"
                        bindValue="value"
                        >
                        </ng-select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label"
                        >Country<span class="text-danger">{{ " *" }}</span>
                        </label>
                        <ng-select
                        [items]="listData.countryList"
                        placeholder="Country"
                        bindLabel="name"
                        formControlName="country"
                        bindValue="code"
                        >
                        </ng-select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label"
                        >GPA<span class="text-danger">{{ " *" }}</span></label>
                        <input formControlName="gpa"
                        type="text"
                        class="form-control"
                        />
                    </div>
                    <div class="col-md-3">
                    <label class="form-label"
                        >Date Of Graduation<span class="text-danger">{{ " *" }}</span></label
                    >
                    <input
                        class="form-control flatpickr-input"
                        type="text"
                        formControlName="dateOfGraduation"
                        mwlFlatpickr
                        [altInput]="true"
                        [convertModelValue]="true"
                    />
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="mt-3 d-flex flex-row">
                <p class="h5">Internship Details</p>
            </div>
            <div formArrayName="internship">
                <div
                    class="mt-2 d-flex flex-column p-3 border"
                    *ngFor="let schools of internshipControls; let i = index"
                    [formGroupName]="i"
                >
                    <div class="row">
                    <div class="col-md-3">
                        <label class="form-label"
                        >Start Date<span class="text-danger">{{ " *" }}</span></label
                        >
                        <input
                        class="form-control flatpickr-input"
                        type="text"
                        mwlFlatpickr
                        [altInput]="true"
                        formControlName="startDate"
                        [convertModelValue]="true"
                        />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label"
                        >End Date<span class="text-danger">{{ " *" }}</span></label
                        >
                        <input
                        class="form-control flatpickr-input"
                        type="text"
                        formControlName="endDate"
                        mwlFlatpickr
                        [altInput]="true"
                        [convertModelValue]="true"
                        />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label"
                        >Institution of Internship<span class="text-danger">{{ " *" }}</span></label
                        >
                        <input
                        type="text"
                        formControlName="institution"
                        class="form-control"
                        />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label"
                        >Current Position<span class="text-danger">{{ " *" }}</span>
                        </label>
                        <ng-select
                        [items]="listData.positions"
                        placeholder="Current Position"
                        formControlName="position">
                        </ng-select>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="d-flex flex-column mt-2">
                <p class="h5">Certificates</p>
                <div class="row">
                <div class="col-md-6 border p-3" formGroupName="blsCertificate">
                    <p class="h6">BLS Certificate</p>
                    <div class="row">
                        <div class="col-md-6" >
                            <div class="mb-3">
                            <label class="form-label"
                                >Expiry Date<span
                                class="text-danger"
                                >{{ " *" }}</span
                                ></label
                            >
                            <input
                                class="form-control flatpickr-input"
                                type="text"
                                mwlFlatpickr
                                [minDate]="todayDate"
                                formControlName="expiryDate"
                                [altInput]="true"
                                [convertModelValue]="true"
                            />
                            </div>
                        </div>
                        <div class="col-md-6 mb-align-items-center justify-content-center">
                            <div class="h-100 d-flex flex-row align-items-center justify-content-center">
                                <p class="h6">Download BLS Certificate</p>
                                <button type="button" class="mx-3 btn btn-outline-primary btn-icon waves-effect waves-light"><i class=" ri-download-cloud-line"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 border p-3" formGroupName="aclsCertificate">
                    <p class="h6">ACLS Certificate</p>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                            <label class="form-label"
                                >Expiry Date<span
                                class="text-danger"
                                >{{ " *" }}</span
                                ></label
                            >
                            <input
                                class="form-control flatpickr-input"
                                type="text"
                                mwlFlatpickr
                                [minDate]="todayDate"
                                formControlName="expiryDate"
                                [altInput]="true"
                                [convertModelValue]="true"
                            />
                            </div>
                        </div>
                        <div class="col-md-6 mb-align-items-center justify-content-center">
                            <div class="h-100 d-flex flex-row align-items-center justify-content-center">
                                <p class="h6">Download ACLS Certificate</p>
                                <button type="button" class="mx-3 btn btn-outline-primary btn-icon waves-effect waves-light"><i class=" ri-download-cloud-line"></i></button>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox"
                            formControlName="isCompletedResidencyProgram"
                            role="switch" id="flexSwitchCheckDefault"/>
                            <label class="form-check-label" for="flexSwitchCheckDefault"
                            ><span class="text-danger px-2">{{" * "}}</span>Have you complete a Residency Program</label
                            >
                        </div>
                    </div>
                </div>
                <div class="col-md-6" *ngIf="formValues.isCompletedResidencyProgram">
                    <label class="form-label" >Please state the name of the Residency Program which you have completed<span class="text-danger">{{ " *" }}</span></label>
                    <input type="text" formControlName="completedResidencyProgramName" class="form-control" />
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox"
                            formControlName="holdsEnglishProficiency"
                            role="switch" id="flexSwitchCheckDefault"/>
                            <label class="form-check-label" for="flexSwitchCheckDefault"
                            ><span class="text-danger px-2">{{" * "}}</span>Do you holds a valid English Proficiency test (IELTS or OET)</label
                            >
                        </div>
                    </div>
                </div>
                <div class="col-md-6" *ngIf="formValues.holdsEnglishProficiency">
                    <label class="form-label" >Overall Score<span class="text-danger">{{ " *" }}</span></label>
                    <input type="text" formControlName="overallScore" class="form-control" />
                </div>
            </div>   
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6 mb-3 align-items-center">
                    <div class="h-100 d-flex flex-row align-items-center">
                        <p class="h6">Download Sponsorship letter from Employer</p>
                        <button type="button" class="mx-3 btn btn-outline-primary btn-icon waves-effect waves-light"><i class=" ri-download-cloud-line"></i></button>
                    </div>
                </div>
            </div>  
        </div>
    </div>
</form>

<ng-template #uploadAcceptanceLetter let-modal>
    <div class="modal-content">
        <div class="modal-body px-4 py-2">
            <div class="d-flex flex-row justify-content-between">
                <label class="form-label mt-2 h5"> Upload Acceptance Letter</label>
                <button type="button" class="btn-close text-end" data-bs-dismiss="modal" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
            </div>
            <form [formGroup]="acceptanceLetterForm">
                <div class="row mt-3">
                    <div class="col-md-4 mb-3">
                        <label class="form-label"
                          >Country of received offer<span class="text-danger">{{ " *" }}</span>
                        </label>
                        <ng-select formControlName="country"
                          [items]="listData.countryList" placeholder="Country"
                          bindLabel="name" bindValue="code">
                        </ng-select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label"
                          >University<span class="text-danger">{{ " *" }}</span>
                        </label>
                        <ng-select formControlName="university"
                          [items]="listData.educationInstitutesList" placeholder="University"
                          bindLabel="name" bindValue="name">
                        </ng-select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label"
                          >Program Type<span class="text-danger">{{ " *" }}</span>
                        </label>
                        <ng-select formControlName="programType"
                          [items]="listData.programType" placeholder="Program Type">
                        </ng-select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label"
                          >Program Specialty<span class="text-danger">{{ " *" }}</span>
                        </label>
                        <ng-select formControlName="programSpecialty"
                          [items]="listData.programSpecialization" placeholder="Program Specialty">
                        </ng-select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label"
                          >Program Sub Specialty<span class="text-danger">{{ " *" }}</span>
                        </label>
                        <ng-select formControlName="programSubSpecialty"
                          [items]="listData.programSubSpecialization" placeholder="Program Sub Specialty">
                        </ng-select>
                    </div>
                    <div class="col-md-4 mb-3" *ngIf="acceptanceLetterFormValues.programSubSpecialty === 'Other'">
                        <label class="form-label"
                          >Program Sub Specialty, If Other<span class="text-danger">{{ " *" }}</span>
                        </label>
                        <input type="text" class="form-control" formControlName="programSubSpecialtyOther">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label"
                          >From<span class="text-danger">{{ " *" }}</span>
                        </label>
                        <input class="form-control flatpickr-input" type="text"
                          formControlName="fromDate" mwlFlatpickr [altInput]="true" [convertModelValue]="true"/>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label"
                          >To<span class="text-danger">{{ " *" }}</span>
                        </label>
                        <input class="form-control flatpickr-input" type="text"
                          formControlName="toDate" mwlFlatpickr [altInput]="true" [convertModelValue]="true" (change)="onChangeFromDate($event.target)"/>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label"
                          >Program Duration<span class="text-danger">{{ " *" }}</span>
                        </label>
                        <label class="form-control">{{acceptanceLetterFormValues.duration}}</label>
                    </div>
                    <div class="col-md-12" >
                        <p class="text-muted">
                            Upload Acceptance Letter<span class="text-danger"
                            >{{ " *" }}</span>
                        </p>
                        <ngx-dropzone (change)="onSelect($event, 'acceptanceLetter')"
                            [multiple]="false">
                            <ngx-dropzone-label>Drop your file here!</ngx-dropzone-label>
                            <ngx-dropzone-preview *ngFor="let f of acceptanceLetter"
                            [removable]="true" (removed)="onRemove(f, 'acceptanceLetter')">
                            <ngx-dropzone-label >{{ f.name }} ({{f.type}})</ngx-dropzone-label>
                            </ngx-dropzone-preview>
                        </ngx-dropzone>
                    </div>
                </div>
                <button class="btn btn-primary mt-3">Submit</button>
            </form>
        </div>
    </div>
</ng-template>